<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èµ·æ¥­å®¶ãƒ¡ãƒ³ã‚¿ãƒ«ã‚±ã‚¢ | å¿ƒã®ã‚»ãƒ«ãƒ•ã‚±ã‚¢ãƒ„ãƒ¼ãƒ«</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 680px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background: white;
            border-radius: 24px;
            padding: 35px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.4);
            margin-top: 20px;
        }

        .logo {
            text-align: center;
            margin-bottom: 10px;
        }

        .logo-text {
            font-size: 0.85rem;
            color: #4ECDC4;
            font-weight: bold;
            letter-spacing: 2px;
        }

        h1 {
            text-align: center;
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 0.95rem;
            line-height: 1.8;
        }

        /* ç·Šæ€¥ãƒœã‚¿ãƒ³ */
        .emergency-btn {
            display: block;
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #FF6B6B 0%, #ee5a5a 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 25px;
            transition: transform 0.2s, box-shadow 0.2s;
            animation: pulse 2s infinite;
        }

        .emergency-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
        }

        /* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .tab-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 25px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 15px;
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            min-width: 70px;
            padding: 12px 10px;
            border: none;
            background: #f0f0f0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: bold;
            color: #666;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: #e0e0e0;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å‘¼å¸ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚º */
        .breathing-container {
            text-align: center;
            padding: 30px 0;
        }

        .breathing-circle {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 4s ease-in-out;
            box-shadow: 0 10px 40px rgba(78, 205, 196, 0.3);
        }

        .breathing-circle.inhale {
            transform: scale(1.4);
        }

        .breathing-circle.hold {
            transform: scale(1.4);
        }

        .breathing-circle.exhale {
            transform: scale(1);
        }

        .breathing-text {
            color: white;
            font-size: 1.3rem;
            font-weight: bold;
        }

        .breathing-instruction {
            font-size: 1.2rem;
            color: #333;
            margin-bottom: 10px;
            min-height: 30px;
        }

        .breathing-timer {
            font-size: 3rem;
            font-weight: bold;
            color: #4ECDC4;
            margin-bottom: 20px;
        }

        .breathing-count {
            color: #999;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .btn {
            padding: 16px 32px;
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(78, 205, 196, 0.4);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-full {
            width: 100%;
        }

        .btn-secondary {
            background: white;
            color: #4ECDC4;
            border: 2px solid #4ECDC4;
        }

        .btn-secondary:hover {
            background: #f0fffd;
            box-shadow: none;
            transform: none;
        }

        /* Quick Win */
        .quick-win-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .quick-win-input input {
            flex: 1;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
        }

        .quick-win-input input:focus {
            outline: none;
            border-color: #4ECDC4;
        }

        .quick-win-input button {
            padding: 14px 20px;
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .win-list {
            list-style: none;
        }

        .win-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: linear-gradient(135deg, #f0fffd 0%, #e8f8f5 100%);
            border-radius: 12px;
            margin-bottom: 10px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .win-item .icon {
            font-size: 1.5rem;
        }

        .win-item .text {
            flex: 1;
            color: #333;
        }

        .win-item .date {
            font-size: 0.8rem;
            color: #999;
        }

        .win-item .delete {
            background: none;
            border: none;
            color: #ccc;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .win-item .delete:hover {
            color: #FF6B6B;
        }

        .win-streak {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #fff9e6 0%, #fff3cd 100%);
            border-radius: 16px;
            margin-bottom: 25px;
        }

        .win-streak .number {
            font-size: 3rem;
            font-weight: bold;
            color: #f5a623;
        }

        .win-streak .label {
            color: #666;
            font-size: 0.9rem;
        }

        /* æ°—åˆ†ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° */
        .mood-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }

        .mood-item {
            padding: 15px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .mood-item:hover {
            border-color: #4ECDC4;
            background: #f0fffd;
        }

        .mood-item.selected {
            border-color: #4ECDC4;
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
            color: white;
        }

        .mood-item .emoji {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .mood-item .label {
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* è¦å› ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° */
        .factor-section {
            background: #f8f9ff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .factor-section h4 {
            color: #333;
            margin-bottom: 15px;
        }

        .factor-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .factor-item {
            padding: 12px 8px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.8rem;
        }

        .factor-item:hover {
            border-color: #4ECDC4;
            background: #f0fffd;
        }

        .factor-item.selected {
            border-color: #4ECDC4;
            background: #e0f7f5;
        }

        .factor-item.negative.selected {
            border-color: #FF6B6B;
            background: #ffe8e8;
        }

        .factor-item .icon {
            font-size: 1.3rem;
            display: block;
            margin-bottom: 5px;
        }

        /* æ„Ÿè¬ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .gratitude-section {
            background: linear-gradient(135deg, #fff9e6 0%, #fff3cd 100%);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .gratitude-section h4 {
            color: #f5a623;
            margin-bottom: 15px;
        }

        .gratitude-input {
            width: 100%;
            padding: 14px;
            border: 2px solid #f5d78e;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            background: white;
        }

        .gratitude-input:focus {
            outline: none;
            border-color: #f5a623;
        }

        /* ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚¨ãƒªã‚¢ */
        .mood-feedback {
            background: linear-gradient(135deg, #f0fffd 0%, #e8f8f5 100%);
            border-radius: 16px;
            padding: 25px;
            margin-top: 20px;
            display: none;
            animation: fadeIn 0.5s;
        }

        .mood-feedback.show {
            display: block;
        }

        .mood-feedback h4 {
            color: #44A08D;
            margin-bottom: 15px;
        }

        .action-suggestion {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #4ECDC4;
        }

        .action-suggestion.warning {
            border-left-color: #FF6B6B;
            background: #fff5f5;
        }

        .action-btn {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .action-btn:hover {
            opacity: 0.9;
        }

        /* ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ */
        .pattern-section {
            background: #f8f9ff;
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
        }

        .pattern-section h4 {
            color: #333;
            margin-bottom: 15px;
        }

        .pattern-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .pattern-item .icon {
            font-size: 1.5rem;
        }

        .pattern-item .text {
            flex: 1;
            color: #333;
            font-size: 0.9rem;
        }

        .pattern-item .badge {
            background: #4ECDC4;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .pattern-item .badge.negative {
            background: #FF6B6B;
        }

        @media (max-width: 500px) {
            .factor-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* ãƒãƒ£ãƒ¼ãƒˆ */
        .chart-container {
            background: #f8f9ff;
            border-radius: 16px;
            padding: 20px;
            margin-top: 25px;
        }

        .chart-container h4 {
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        /* ç·Šæ€¥ãƒ¢ãƒ¼ãƒ‰ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        .emergency-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .emergency-overlay.show {
            display: flex;
        }

        .emergency-content {
            background: white;
            border-radius: 24px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            animation: zoomIn 0.3s ease-out;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes zoomIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .emergency-content h2 {
            color: #FF6B6B;
            margin-bottom: 20px;
        }

        .emergency-breathing {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF6B6B 0%, #ee5a5a 100%);
            margin: 30px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 4s ease-in-out;
            box-shadow: 0 10px 40px rgba(255, 107, 107, 0.3);
        }

        .emergency-breathing.inhale {
            transform: scale(1.3);
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
        }

        .emergency-breathing.exhale {
            transform: scale(1);
        }

        .emergency-breathing .text {
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .grounding-step {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            text-align: left;
        }

        .grounding-step h4 {
            color: #4ECDC4;
            margin-bottom: 10px;
        }

        .grounding-step p {
            color: #666;
            line-height: 1.6;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            color: white;
            cursor: pointer;
        }

        /* ã‚¬ã‚¤ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .guide-section {
            background: #fff5f5;
            border-radius: 16px;
            padding: 25px;
            margin-top: 20px;
        }

        .guide-section h3 {
            color: #FF6B6B;
            margin-bottom: 15px;
        }

        .info-box {
            background: #f0fffd;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .info-box h4 {
            color: #44A08D;
            margin-bottom: 15px;
        }

        .warning-signs {
            list-style: none;
            padding: 0;
        }

        .warning-signs li {
            padding: 12px 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .warning-signs li .icon {
            font-size: 1.2rem;
        }

        .textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 15px;
        }

        .textarea:focus {
            outline: none;
            border-color: #4ECDC4;
        }

        .response-area {
            background: linear-gradient(135deg, #f0fffd 0%, #e8f8f5 100%);
            border-radius: 16px;
            padding: 25px;
            margin-top: 20px;
            display: none;
        }

        .response-area.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        .response-area h3 {
            color: #44A08D;
            margin-bottom: 15px;
        }

        .distortion-box {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #FF6B6B;
        }

        .distortion-box h4 {
            color: #FF6B6B;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .reframe-box {
            background: white;
            border-radius: 12px;
            padding: 15px;
            border-left: 4px solid #4ECDC4;
            margin-bottom: 15px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .reframe-box:hover {
            transform: translateX(5px);
        }

        .reframe-box h4 {
            color: #44A08D;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 500px) {
            .card {
                padding: 25px 20px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .mood-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .tab-btn {
                padding: 10px 6px;
                font-size: 0.75rem;
            }

            .breathing-circle {
                width: 150px;
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <!-- ç·Šæ€¥ãƒ¢ãƒ¼ãƒ‰ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div class="emergency-overlay" id="emergency-overlay">
        <button class="close-btn" onclick="closeEmergency()">&times;</button>
        <div class="emergency-content">
            <h2 id="emergency-title">ã¾ãšã€æ·±å‘¼å¸ã—ã¾ã—ã‚‡ã†</h2>

            <div id="emergency-breathing-section">
                <div class="emergency-breathing" id="emergency-circle">
                    <span class="text" id="emergency-breath-text">æº–å‚™</span>
                </div>
                <p id="emergency-instruction" style="font-size: 1.1rem; color: #666; margin-bottom: 20px;">
                    å††ã‚’è¦‹ãªãŒã‚‰ä¸€ç·’ã«å‘¼å¸ã—ã¾ã—ã‚‡ã†
                </p>
                <button class="btn" onclick="startEmergencyBreathing()">å‘¼å¸ã‚’å§‹ã‚ã‚‹</button>
            </div>

            <div id="emergency-grounding-section" style="display: none;">
                <p style="color: #666; margin-bottom: 20px;">
                    5ã¤ã®æ„Ÿè¦šã‚’ä½¿ã£ã¦ã€Œä»Šã“ã“ã€ã«æˆ»ã‚Šã¾ã—ã‚‡ã†
                </p>
                <div class="grounding-step">
                    <h4>ğŸ‘€ 5ã¤è¦‹ã¤ã‘ã¦</h4>
                    <p>ä»Šã€ç›®ã«è¦‹ãˆã‚‹ã‚‚ã®ã‚’5ã¤å¿ƒã®ä¸­ã§è¨€ã£ã¦ãã ã•ã„</p>
                </div>
                <div class="grounding-step">
                    <h4>ğŸ‘‚ 4ã¤èã„ã¦</h4>
                    <p>ä»Šã€èã“ãˆã‚‹éŸ³ã‚’4ã¤è¦‹ã¤ã‘ã¦ãã ã•ã„</p>
                </div>
                <div class="grounding-step">
                    <h4>âœ‹ 3ã¤è§¦ã£ã¦</h4>
                    <p>ä»Šã€è§¦ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’3ã¤æ„Ÿã˜ã¦ãã ã•ã„</p>
                </div>
                <div class="grounding-step">
                    <h4>ğŸ‘ƒ 2ã¤å—…ã„ã§</h4>
                    <p>ä»Šã€æ„Ÿã˜ã‚‹åŒ‚ã„ã‚’2ã¤è¦‹ã¤ã‘ã¦ãã ã•ã„</p>
                </div>
                <div class="grounding-step">
                    <h4>ğŸ‘… 1ã¤å‘³ã‚ã£ã¦</h4>
                    <p>ä»Šã€å£ã®ä¸­ã®å‘³ã‚’1ã¤æ„Ÿã˜ã¦ãã ã•ã„</p>
                </div>
                <button class="btn btn-full" onclick="closeEmergency()" style="margin-top: 20px;">è½ã¡ç€ã„ãŸ</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="card">
            <div class="logo">
                <span class="logo-text">ENTREPRENEUR MENTAL CARE</span>
            </div>
            <h1>èµ·æ¥­å®¶ãƒ¡ãƒ³ã‚¿ãƒ«ã‚±ã‚¢</h1>
            <p class="subtitle">ä»Šã™ãä½¿ãˆã‚‹å¿ƒã®ã‚»ãƒ«ãƒ•ã‚±ã‚¢ãƒ„ãƒ¼ãƒ«</p>

            <!-- ç·Šæ€¥ãƒœã‚¿ãƒ³ -->
            <button class="emergency-btn" onclick="openEmergency()">
                ğŸ†˜ ä»Šã™ãè½ã¡ç€ããŸã„
            </button>

            <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="tab-nav">
                <button class="tab-btn active" onclick="showTab('breathing')">ğŸŒ¬ï¸ å‘¼å¸</button>
                <button class="tab-btn" onclick="showTab('wins')">ğŸ† å‹åˆ©</button>
                <button class="tab-btn" onclick="showTab('mood')">ğŸ“Š è¨˜éŒ²</button>
                <button class="tab-btn" onclick="showTab('reframe')">ğŸ’­ è»¢æ›</button>
                <button class="tab-btn" onclick="showTab('guide')">ğŸ“– æƒ…å ±</button>
            </div>

            <!-- ã‚¿ãƒ–1: å‘¼å¸ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚º -->
            <div class="tab-content active" id="tab-breathing">
                <h3 style="text-align: center; margin-bottom: 10px; color: #333;">å‘¼å¸ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚º</h3>
                <p style="text-align: center; color: #666; margin-bottom: 20px; font-size: 0.9rem;">
                    4-7-8å‘¼å¸æ³•ã§ãƒªãƒ©ãƒƒã‚¯ã‚¹<br>
                    <small>ï¼ˆ4ç§’å¸ã†â†’7ç§’æ­¢ã‚ã‚‹â†’8ç§’åãï¼‰</small>
                </p>

                <div class="breathing-container">
                    <div class="breathing-circle" id="breathing-circle">
                        <span class="breathing-text" id="breathing-text">æº–å‚™OK</span>
                    </div>

                    <div class="breathing-instruction" id="breathing-instruction"></div>
                    <div class="breathing-timer" id="breathing-timer">0</div>
                    <div class="breathing-count" id="breathing-count">0 / 3 ã‚µã‚¤ã‚¯ãƒ«</div>

                    <button class="btn" id="breathing-btn" onclick="toggleBreathing()">
                        å‘¼å¸ã‚’å§‹ã‚ã‚‹
                    </button>
                </div>

                <div style="background: #f8f9ff; border-radius: 12px; padding: 20px; margin-top: 20px;">
                    <h4 style="color: #333; margin-bottom: 10px;">ğŸ’¡ åŠ¹æœ</h4>
                    <ul style="color: #666; padding-left: 20px; line-height: 1.8;">
                        <li>å‰¯äº¤æ„Ÿç¥çµŒã‚’æ´»æ€§åŒ–ã—ã¦ãƒªãƒ©ãƒƒã‚¯ã‚¹</li>
                        <li>ä¸å®‰ã‚„ç·Šå¼µã‚’å’Œã‚‰ã’ã‚‹</li>
                        <li>é›†ä¸­åŠ›ã‚’é«˜ã‚ã‚‹</li>
                        <li>ç¡çœ ã®è³ªã‚’æ”¹å–„</li>
                    </ul>
                </div>
            </div>

            <!-- ã‚¿ãƒ–2: Quick Win -->
            <div class="tab-content" id="tab-wins">
                <h3 style="margin-bottom: 10px; color: #333;">ä»Šæ—¥ã®å°ã•ãªå‹åˆ©</h3>
                <p style="color: #666; margin-bottom: 20px; font-size: 0.9rem;">
                    ã©ã‚“ãªå°ã•ãªã“ã¨ã§ã‚‚OKï¼<br>
                    æ¯æ—¥ã®ã€Œã§ããŸã€ã‚’ç©ã¿é‡ã­ã‚ˆã†
                </p>

                <div class="win-streak">
                    <div class="number" id="streak-count">0</div>
                    <div class="label">æ—¥é€£ç¶šã§å‹åˆ©ã‚’è¨˜éŒ²ä¸­ ğŸ”¥</div>
                </div>

                <div class="quick-win-input">
                    <input type="text" id="win-input" placeholder="ä»Šæ—¥ã§ããŸã“ã¨ã‚’å…¥åŠ›..." onkeypress="if(event.key==='Enter')addWin()">
                    <button onclick="addWin()">+</button>
                </div>

                <div style="margin-bottom: 15px;">
                    <small style="color: #999;">ä¾‹: ãƒ¡ãƒ¼ãƒ«1é€šè¿”ä¿¡ã—ãŸ / 5åˆ†ã ã‘ä½œæ¥­ã—ãŸ / æœèµ·ãã‚ŒãŸ</small>
                </div>

                <h4 style="color: #333; margin-bottom: 15px;">ğŸ“… ä»Šæ—¥ã®å‹åˆ©</h4>
                <ul class="win-list" id="today-wins">
                    <p style="color: #999; text-align: center; padding: 20px;">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>
                </ul>

                <h4 style="color: #333; margin: 25px 0 15px;">ğŸ“œ éå»ã®å‹åˆ©</h4>
                <ul class="win-list" id="past-wins">
                    <p style="color: #999; text-align: center; padding: 20px;">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>
                </ul>
            </div>

            <!-- ã‚¿ãƒ–3: æ°—åˆ†è¨˜éŒ² -->
            <div class="tab-content" id="tab-mood">
                <h3 style="margin-bottom: 20px; color: #333;">ä»Šã®æ°—åˆ†ã‚’è¨˜éŒ²</h3>

                <div class="mood-grid">
                    <div class="mood-item" onclick="selectMood(this, 5)">
                        <div class="emoji">ğŸ˜„</div>
                        <div class="label">ã¨ã¦ã‚‚è‰¯ã„</div>
                    </div>
                    <div class="mood-item" onclick="selectMood(this, 4)">
                        <div class="emoji">ğŸ™‚</div>
                        <div class="label">è‰¯ã„</div>
                    </div>
                    <div class="mood-item" onclick="selectMood(this, 3)">
                        <div class="emoji">ğŸ˜</div>
                        <div class="label">æ™®é€š</div>
                    </div>
                    <div class="mood-item" onclick="selectMood(this, 2)">
                        <div class="emoji">ğŸ˜°</div>
                        <div class="label">ä¸å®‰</div>
                    </div>
                    <div class="mood-item" onclick="selectMood(this, 1)">
                        <div class="emoji">ğŸ˜¢</div>
                        <div class="label">ã¤ã‚‰ã„</div>
                    </div>
                    <div class="mood-item" onclick="selectMood(this, 0)">
                        <div class="emoji">ğŸ˜¤</div>
                        <div class="label">ã‚¤ãƒ©ã‚¤ãƒ©</div>
                    </div>
                </div>

                <!-- è¦å› ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° -->
                <div class="factor-section">
                    <h4>ğŸ“‹ ä»Šæ—¥ã®çŠ¶æ…‹ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</h4>
                    <div class="factor-grid">
                        <div class="factor-item" onclick="toggleFactor(this, 'sleep_good')" data-factor="sleep_good">
                            <span class="icon">ğŸ˜´</span>ã‚ˆãå¯ãŸ
                        </div>
                        <div class="factor-item" onclick="toggleFactor(this, 'exercise')" data-factor="exercise">
                            <span class="icon">ğŸƒ</span>é‹å‹•ã—ãŸ
                        </div>
                        <div class="factor-item" onclick="toggleFactor(this, 'outdoor')" data-factor="outdoor">
                            <span class="icon">ğŸŒ</span>å¤–å‡ºã—ãŸ
                        </div>
                        <div class="factor-item" onclick="toggleFactor(this, 'social')" data-factor="social">
                            <span class="icon">ğŸ‘¥</span>äººã¨ä¼šã£ãŸ
                        </div>
                        <div class="factor-item" onclick="toggleFactor(this, 'progress')" data-factor="progress">
                            <span class="icon">ğŸ“ˆ</span>ä»•äº‹é€²ã‚“ã 
                        </div>
                        <div class="factor-item" onclick="toggleFactor(this, 'relax')" data-factor="relax">
                            <span class="icon">ğŸ›‹ï¸</span>ä¼‘æ¯ã¨ã‚ŒãŸ
                        </div>
                        <div class="factor-item negative" onclick="toggleFactor(this, 'sleep_bad')" data-factor="sleep_bad">
                            <span class="icon">ğŸ˜µ</span>å¯ä¸è¶³
                        </div>
                        <div class="factor-item negative" onclick="toggleFactor(this, 'stress')" data-factor="stress">
                            <span class="icon">ğŸ˜°</span>ã‚¹ãƒˆãƒ¬ã‚¹
                        </div>
                    </div>
                </div>

                <!-- æ„Ÿè¬ã®è¨˜éŒ² -->
                <div class="gratitude-section">
                    <h4>âœ¨ ä»Šæ—¥è‰¯ã‹ã£ãŸã“ã¨ï¼ˆä»»æ„ï¼‰</h4>
                    <input type="text" class="gratitude-input" id="gratitude-input" placeholder="ä¾‹: ç¾å‘³ã—ã„ã‚³ãƒ¼ãƒ’ãƒ¼ãŒé£²ã‚ãŸ">
                </div>

                <textarea class="textarea" id="mood-note" placeholder="ä¸€è¨€ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰" style="margin-bottom: 15px;"></textarea>
                <button class="btn btn-full" onclick="saveMood()">è¨˜éŒ²ã™ã‚‹</button>

                <!-- å³æ™‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ -->
                <div class="mood-feedback" id="mood-feedback"></div>

                <!-- ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ -->
                <div class="pattern-section" id="pattern-section" style="display: none;">
                    <h4>ğŸ” ã‚ãªãŸã®ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ</h4>
                    <div id="pattern-results"></div>
                </div>

                <div class="chart-container" id="mood-chart-container" style="display: none;">
                    <h4>ğŸ“ˆ éå»7æ—¥é–“ã®æ°—åˆ†æ¨ç§»</h4>
                    <canvas id="mood-chart"></canvas>
                </div>
            </div>

            <!-- ã‚¿ãƒ–4: æ€è€ƒè»¢æ› -->
            <div class="tab-content" id="tab-reframe">
                <h3 style="margin-bottom: 10px; color: #333;">èµ·æ¥­å®¶ã®æ€è€ƒè»¢æ›</h3>
                <p style="color: #666; margin-bottom: 20px; font-size: 0.9rem;">
                    ä¸å®‰ã‚„æ‚©ã¿ã‚’æ›¸ãå‡ºã—ã¦ã€åˆ¥ã®è¦–ç‚¹ã‚’è¦‹ã¤ã‘ã¾ã—ã‚‡ã†
                </p>

                <textarea class="textarea" id="worry-input" placeholder="ä¾‹ï¼šèµ·æ¥­ã—ãŸã„ã‘ã©ã€å¤±æ•—ã—ãŸã‚‰ã©ã†ã—ã‚ˆã†..." style="min-height: 120px;"></textarea>

                <button class="btn btn-full" onclick="analyzeWorry()">ğŸ” åˆ†æã™ã‚‹</button>

                <div class="response-area" id="worry-response"></div>

                <div style="margin-top: 30px;">
                    <h4 style="color: #333; margin-bottom: 15px;">ğŸ’¡ ã‚ˆãã‚ã‚‹èµ·æ¥­å®¶ã®ä¸å®‰ã¨è»¢æ›</h4>

                    <div class="reframe-box" onclick="fillWorry('å¤±æ•—ã—ãŸã‚‰ã©ã†ã—ã‚ˆã†')">
                        <h4>ã€Œå¤±æ•—ã—ãŸã‚‰ã©ã†ã—ã‚ˆã†ã€</h4>
                        <p style="color: #666; font-size: 0.9rem;">â†’ å¤±æ•—ã¯å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã€‚æˆåŠŸã—ãŸèµ·æ¥­å®¶ã®å¹³å‡å¤±æ•—å›æ•°ã¯3.8å›</p>
                    </div>

                    <div class="reframe-box" onclick="fillWorry('å‘¨ã‚Šã«åå¯¾ã•ã‚Œã‚‹')">
                        <h4>ã€Œå‘¨ã‚Šã«åå¯¾ã•ã‚Œã‚‹ã€</h4>
                        <p style="color: #666; font-size: 0.9rem;">â†’ ç†è§£ã•ã‚Œãªã„ã®ã¯å…ˆé§†è€…ã®è¨¼ã€‚åå¯¾ã®97%ã¯å¿ƒé…ã‹ã‚‰ãã‚‹æ„›æƒ…</p>
                    </div>

                    <div class="reframe-box" onclick="fillWorry('è‡ªåˆ†ã«ã¯æ‰èƒ½ãŒãªã„')">
                        <h4>ã€Œè‡ªåˆ†ã«ã¯æ‰èƒ½ãŒãªã„ã€</h4>
                        <p style="color: #666; font-size: 0.9rem;">â†’ æ‰èƒ½ã‚ˆã‚Šç¶™ç¶šã€‚1ä¸‡æ™‚é–“ã®æ³•å‰‡ã¯èª°ã«ã§ã‚‚é©ç”¨ã•ã‚Œã‚‹</p>
                    </div>

                    <div class="reframe-box" onclick="fillWorry('ãŠé‡‘ãŒãªããªã£ãŸã‚‰')">
                        <h4>ã€ŒãŠé‡‘ãŒãªããªã£ãŸã‚‰ã€</h4>
                        <p style="color: #666; font-size: 0.9rem;">â†’ æœ€æ‚ªã®ã‚±ãƒ¼ã‚¹ã‚’å…·ä½“çš„ã«ã€‚ã€Œãƒã‚¤ãƒˆã™ã‚Œã°ã„ã„ã€ã§æ„å¤–ã¨ä½•ã¨ã‹ãªã‚‹</p>
                    </div>
                </div>
            </div>

            <!-- ã‚¿ãƒ–5: ã‚¬ã‚¤ãƒ‰ -->
            <div class="tab-content" id="tab-guide">
                <h3 style="margin-bottom: 20px; color: #333;">èµ·æ¥­å®¶ã®ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹</h3>

                <div class="info-box">
                    <h4>ğŸ“Š çŸ¥ã£ã¦ãŠããŸã„çµ±è¨ˆ</h4>
                    <ul style="padding-left: 20px; color: #555; line-height: 1.8;">
                        <li>èµ·æ¥­å®¶ã®<strong>72%</strong>ãŒãƒ¡ãƒ³ã‚¿ãƒ«ã®å•é¡Œã‚’çµŒé¨“</li>
                        <li>ä¸€èˆ¬ã®äººã‚ˆã‚Š<strong>ã†ã¤ç—…ãƒªã‚¹ã‚¯ãŒ2å€</strong></li>
                        <li>ã—ã‹ã—<strong>81%</strong>ãŒèª°ã«ã‚‚ç›¸è«‡ã—ã¦ã„ãªã„</li>
                    </ul>
                    <p style="color: #44A08D; font-weight: bold; margin-top: 15px;">â†’ ã‚ãªãŸã ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                </div>

                <div class="guide-section">
                    <h3>âš ï¸ è¦æ³¨æ„ã‚µã‚¤ãƒ³</h3>
                    <p style="color: #666; margin-bottom: 15px;">ä»¥ä¸‹ã®ç—‡çŠ¶ãŒ2é€±é–“ä»¥ä¸Šç¶šãå ´åˆã¯å°‚é–€å®¶ã¸</p>
                    <ul class="warning-signs">
                        <li><span class="icon">ğŸ˜´</span> ç¡çœ éšœå®³ãŒç¶šã</li>
                        <li><span class="icon">ğŸ½ï¸</span> é£Ÿæ¬²ã®å¤§ããªå¤‰åŒ–</li>
                        <li><span class="icon">ğŸ˜”</span> ä½•ã‚’ã—ã¦ã‚‚æ¥½ã—ããªã„</li>
                        <li><span class="icon">ğŸ”„</span> åŒã˜ä¸å®‰ãŒé ­ã‹ã‚‰é›¢ã‚Œãªã„</li>
                        <li><span class="icon">ğŸš«</span> ã€Œæ¶ˆãˆãŸã„ã€ã¨ã„ã†æ°—æŒã¡</li>
                    </ul>
                </div>

                <div style="background: #e8f5e9; border-radius: 16px; padding: 20px; margin-top: 20px;">
                    <h4 style="color: #2e7d32; margin-bottom: 15px;">ğŸ†˜ ç›¸è«‡å…ˆ</h4>
                    <ul style="padding-left: 20px; color: #555; line-height: 2;">
                        <li><strong>ã‚ˆã‚Šãã„ãƒ›ãƒƒãƒˆãƒ©ã‚¤ãƒ³:</strong> 0120-279-338ï¼ˆ24æ™‚é–“ï¼‰</li>
                        <li><strong>ã„ã®ã¡ã®é›»è©±:</strong> 0570-783-556</li>
                        <li><strong>ã“ã“ã‚ã®å¥åº·ç›¸è«‡:</strong> 0570-064-556</li>
                    </ul>
                    <p style="color: #2e7d32; margin-top: 15px; font-size: 0.9rem;">
                        â€» åŠ©ã‘ã‚’æ±‚ã‚ã‚‹ã“ã¨ã¯å¼·ã•ã§ã™
                    </p>
                </div>
            </div>

        </div>
    </div>

    <script>
        // ==================== åˆæœŸåŒ– ====================
        let breathingInterval = null;
        let isBreathing = false;
        let breathCycle = 0;
        let selectedMoodValue = null;
        let moodHistory = [];
        let winHistory = [];
        let moodChart = null;

        // èµ·å‹•æ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        loadAllData();

        // ==================== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ ====================
        function showTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
        }

        // ==================== å‘¼å¸ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚º ====================
        function toggleBreathing() {
            if (isBreathing) {
                stopBreathing();
            } else {
                startBreathing();
            }
        }

        function startBreathing() {
            isBreathing = true;
            breathCycle = 0;
            document.getElementById('breathing-btn').textContent = 'åœæ­¢';
            runBreathingCycle();
        }

        function stopBreathing() {
            isBreathing = false;
            clearTimeout(breathingInterval);
            document.getElementById('breathing-btn').textContent = 'å‘¼å¸ã‚’å§‹ã‚ã‚‹';
            document.getElementById('breathing-circle').className = 'breathing-circle';
            document.getElementById('breathing-text').textContent = 'æº–å‚™OK';
            document.getElementById('breathing-instruction').textContent = '';
            document.getElementById('breathing-timer').textContent = '0';
        }

        function runBreathingCycle() {
            if (!isBreathing) return;

            const circle = document.getElementById('breathing-circle');
            const text = document.getElementById('breathing-text');
            const instruction = document.getElementById('breathing-instruction');
            const timer = document.getElementById('breathing-timer');
            const count = document.getElementById('breathing-count');

            // å¸ã† (4ç§’)
            circle.className = 'breathing-circle inhale';
            text.textContent = 'å¸ã†';
            instruction.textContent = 'é¼»ã‹ã‚‰ã‚†ã£ãã‚Šå¸ã£ã¦...';
            countdown(4, timer, () => {
                if (!isBreathing) return;

                // æ­¢ã‚ã‚‹ (7ç§’)
                circle.className = 'breathing-circle hold';
                text.textContent = 'æ­¢ã‚ã‚‹';
                instruction.textContent = 'æ¯ã‚’æ­¢ã‚ã¦...';
                countdown(7, timer, () => {
                    if (!isBreathing) return;

                    // åã (8ç§’)
                    circle.className = 'breathing-circle exhale';
                    text.textContent = 'åã';
                    instruction.textContent = 'å£ã‹ã‚‰ã‚†ã£ãã‚Šåã„ã¦...';
                    countdown(8, timer, () => {
                        if (!isBreathing) return;

                        breathCycle++;
                        count.textContent = `${breathCycle} / 3 ã‚µã‚¤ã‚¯ãƒ«`;

                        if (breathCycle >= 3) {
                            // å®Œäº†
                            stopBreathing();
                            instruction.textContent = 'ğŸ‰ ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼';
                            text.textContent = 'å®Œäº†';
                            count.textContent = '3 / 3 ã‚µã‚¤ã‚¯ãƒ«å®Œäº†ï¼';
                        } else {
                            // æ¬¡ã®ã‚µã‚¤ã‚¯ãƒ«
                            runBreathingCycle();
                        }
                    });
                });
            });
        }

        function countdown(seconds, element, callback) {
            let remaining = seconds;
            element.textContent = remaining;

            const interval = setInterval(() => {
                remaining--;
                element.textContent = remaining;

                if (remaining <= 0) {
                    clearInterval(interval);
                    callback();
                }
            }, 1000);

            breathingInterval = interval;
        }

        // ==================== ç·Šæ€¥ãƒ¢ãƒ¼ãƒ‰ ====================
        let emergencyBreathing = false;

        function openEmergency() {
            document.getElementById('emergency-overlay').classList.add('show');
            document.getElementById('emergency-breathing-section').style.display = 'block';
            document.getElementById('emergency-grounding-section').style.display = 'none';
            document.getElementById('emergency-title').textContent = 'ã¾ãšã€æ·±å‘¼å¸ã—ã¾ã—ã‚‡ã†';
            document.getElementById('emergency-circle').className = 'emergency-breathing';
            document.getElementById('emergency-breath-text').textContent = 'æº–å‚™';
        }

        function closeEmergency() {
            document.getElementById('emergency-overlay').classList.remove('show');
            emergencyBreathing = false;
        }

        function startEmergencyBreathing() {
            emergencyBreathing = true;
            let cycles = 0;

            function breathe() {
                if (!emergencyBreathing) return;

                const circle = document.getElementById('emergency-circle');
                const text = document.getElementById('emergency-breath-text');
                const instruction = document.getElementById('emergency-instruction');

                // å¸ã†
                circle.className = 'emergency-breathing inhale';
                text.textContent = 'å¸ã†';
                instruction.textContent = '4ç§’ã‹ã‘ã¦å¸ã£ã¦...';

                setTimeout(() => {
                    if (!emergencyBreathing) return;
                    // åã
                    circle.className = 'emergency-breathing exhale';
                    text.textContent = 'åã';
                    instruction.textContent = '6ç§’ã‹ã‘ã¦åã„ã¦...';

                    setTimeout(() => {
                        cycles++;
                        if (cycles >= 3) {
                            // ã‚°ãƒ©ã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã«ç§»è¡Œ
                            emergencyBreathing = false;
                            document.getElementById('emergency-breathing-section').style.display = 'none';
                            document.getElementById('emergency-grounding-section').style.display = 'block';
                            document.getElementById('emergency-title').textContent = 'æ¬¡ã¯ã€Œä»Šã“ã“ã€ã«æˆ»ã‚Šã¾ã—ã‚‡ã†';
                        } else {
                            breathe();
                        }
                    }, 6000);
                }, 4000);
            }

            breathe();
        }

        // ==================== Quick Win ====================
        function addWin() {
            const input = document.getElementById('win-input');
            const text = input.value.trim();
            if (!text) return;

            const today = new Date().toLocaleDateString('ja-JP');
            const win = {
                id: Date.now(),
                text: text,
                date: today,
                time: new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' })
            };

            winHistory.unshift(win);
            localStorage.setItem('mentalcare_wins', JSON.stringify(winHistory));

            input.value = '';
            displayWins();
            updateStreak();
        }

        function deleteWin(id) {
            winHistory = winHistory.filter(w => w.id !== id);
            localStorage.setItem('mentalcare_wins', JSON.stringify(winHistory));
            displayWins();
            updateStreak();
        }

        function displayWins() {
            const today = new Date().toLocaleDateString('ja-JP');
            const todayWins = winHistory.filter(w => w.date === today);
            const pastWins = winHistory.filter(w => w.date !== today).slice(0, 10);

            const icons = ['ğŸŒŸ', 'â­', 'âœ¨', 'ğŸ’ª', 'ğŸ¯', 'ğŸš€', 'ğŸ’¡', 'ğŸ”¥'];

            const todayContainer = document.getElementById('today-wins');
            if (todayWins.length === 0) {
                todayContainer.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';
            } else {
                todayContainer.innerHTML = todayWins.map(w => `
                    <li class="win-item">
                        <span class="icon">${icons[Math.floor(Math.random() * icons.length)]}</span>
                        <span class="text">${escapeHtml(w.text)}</span>
                        <span class="date">${w.time}</span>
                        <button class="delete" onclick="deleteWin(${w.id})">&times;</button>
                    </li>
                `).join('');
            }

            const pastContainer = document.getElementById('past-wins');
            if (pastWins.length === 0) {
                pastContainer.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';
            } else {
                pastContainer.innerHTML = pastWins.map(w => `
                    <li class="win-item">
                        <span class="icon">${icons[Math.floor(Math.random() * icons.length)]}</span>
                        <span class="text">${escapeHtml(w.text)}</span>
                        <span class="date">${w.date}</span>
                        <button class="delete" onclick="deleteWin(${w.id})">&times;</button>
                    </li>
                `).join('');
            }
        }

        function updateStreak() {
            // é€£ç¶šè¨˜éŒ²æ—¥æ•°ã‚’è¨ˆç®—
            const dates = [...new Set(winHistory.map(w => w.date))].sort().reverse();
            let streak = 0;
            const today = new Date();

            for (let i = 0; i < dates.length; i++) {
                const checkDate = new Date(today);
                checkDate.setDate(checkDate.getDate() - i);
                const checkStr = checkDate.toLocaleDateString('ja-JP');

                if (dates.includes(checkStr)) {
                    streak++;
                } else {
                    break;
                }
            }

            document.getElementById('streak-count').textContent = streak;
        }

        // ==================== æ°—åˆ†è¨˜éŒ² ====================
        let selectedFactors = [];

        function selectMood(element, value) {
            document.querySelectorAll('.mood-item').forEach(item => item.classList.remove('selected'));
            element.classList.add('selected');
            selectedMoodValue = value;
        }

        function toggleFactor(element, factor) {
            element.classList.toggle('selected');
            if (selectedFactors.includes(factor)) {
                selectedFactors = selectedFactors.filter(f => f !== factor);
            } else {
                selectedFactors.push(factor);
            }
        }

        function saveMood() {
            if (selectedMoodValue === null) {
                alert('æ°—åˆ†ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const gratitude = document.getElementById('gratitude-input').value.trim();
            const note = document.getElementById('mood-note').value.trim();

            const entry = {
                date: new Date().toLocaleDateString('ja-JP'),
                time: new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
                mood: selectedMoodValue,
                factors: [...selectedFactors],
                gratitude: gratitude,
                note: note
            };

            moodHistory.unshift(entry);
            if (moodHistory.length > 30) moodHistory.pop();

            localStorage.setItem('mentalcare_mood', JSON.stringify(moodHistory));

            // å³æ™‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¡¨ç¤º
            showMoodFeedback(selectedMoodValue, selectedFactors);

            // ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æã‚’æ›´æ–°
            analyzePatterns();

            // å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('mood-note').value = '';
            document.getElementById('gratitude-input').value = '';
            document.querySelectorAll('.mood-item').forEach(item => item.classList.remove('selected'));
            document.querySelectorAll('.factor-item').forEach(item => item.classList.remove('selected'));
            selectedMoodValue = null;
            selectedFactors = [];

            displayMoodChart();
        }

        function showMoodFeedback(mood, factors) {
            const feedbackArea = document.getElementById('mood-feedback');
            let html = '';

            const moodLabels = {
                5: 'ã¨ã¦ã‚‚è‰¯ã„',
                4: 'è‰¯ã„',
                3: 'æ™®é€š',
                2: 'ä¸å®‰',
                1: 'ã¤ã‚‰ã„',
                0: 'ã‚¤ãƒ©ã‚¤ãƒ©'
            };

            // æ°—åˆ†ã«å¿œã˜ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            if (mood >= 4) {
                html += `
                    <h4>ğŸ‰ ç´ æ™´ã‚‰ã—ã„ï¼</h4>
                    <p>ä»Šæ—¥ã¯æ°—åˆ†ãŒã€Œ${moodLabels[mood]}ã€ã§ã™ã­ï¼</p>
                `;

                // ãƒã‚¸ãƒ†ã‚£ãƒ–è¦å› ã‚’å¼·èª¿
                if (factors.length > 0) {
                    const positiveFactors = factors.filter(f => !['sleep_bad', 'stress'].includes(f));
                    if (positiveFactors.length > 0) {
                        html += `<div class="action-suggestion">
                            <strong>ğŸ’¡ ä»Šæ—¥ã®è‰¯ã„ç¿’æ…£ã‚’ç¶šã‘ã¾ã—ã‚‡ã†ï¼</strong>
                            <p style="margin-top: 8px; color: #666; font-size: 0.9rem;">
                                ${getFactorLabels(positiveFactors).join('ã€')}ãŒæ°—åˆ†ã®è‰¯ã•ã«è²¢çŒ®ã—ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
                            </p>
                        </div>`;
                    }
                }
            } else if (mood === 3) {
                html += `
                    <h4>ğŸ“ è¨˜éŒ²ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™</h4>
                    <p>ã€Œæ™®é€šã€ã®æ—¥ã‚‚å¤§åˆ‡ãªè¨˜éŒ²ã§ã™ã€‚</p>
                    <div class="action-suggestion">
                        <strong>ğŸ’¡ ã¡ã‚‡ã£ã¨ã—ãŸå¤‰åŒ–ã‚’è©¦ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ</strong>
                        <p style="margin-top: 8px; color: #666; font-size: 0.9rem;">
                            5åˆ†ã®æ•£æ­©ã‚„æ·±å‘¼å¸ã§ã€æ°—åˆ†ãŒä¸Šå‘ãã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
                        </p>
                    </div>
                `;
            } else {
                // mood <= 2 (ã¤ã‚‰ã„ã€ä¸å®‰ã€ã‚¤ãƒ©ã‚¤ãƒ©)
                html += `
                    <h4>ğŸ’š è¾›ã„æ™‚ã«è¨˜éŒ²ã§ããŸè‡ªåˆ†ã‚’è¤’ã‚ã¾ã—ã‚‡ã†</h4>
                    <p>ä»Šæ—¥ã¯æ°—åˆ†ãŒã€Œ${moodLabels[mood]}ã€ãªã‚“ã§ã™ã­ã€‚ãã‚Œã‚’èªè­˜ã§ãã¦ã„ã‚‹ã“ã¨ãŒå¤§äº‹ã§ã™ã€‚</p>
                `;

                // ãƒã‚¬ãƒ†ã‚£ãƒ–è¦å› ã¸ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹
                if (factors.includes('sleep_bad')) {
                    html += `<div class="action-suggestion warning">
                        <strong>ğŸ˜´ ç¡çœ ä¸è¶³ãŒå½±éŸ¿ã—ã¦ã„ã‚‹ã‹ã‚‚</strong>
                        <p style="margin-top: 8px; color: #666; font-size: 0.9rem;">
                            ä»Šå¤œã¯æ—©ã‚ã«å¯ã‚‹ã“ã¨ã‚’æœ€å„ªå…ˆã«ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿç¡çœ ã¯æ°—åˆ†ã«å¤§ããå½±éŸ¿ã—ã¾ã™ã€‚
                        </p>
                    </div>`;
                }

                if (factors.includes('stress')) {
                    html += `<div class="action-suggestion warning">
                        <strong>ğŸ˜° ã‚¹ãƒˆãƒ¬ã‚¹ã‚’æ„Ÿã˜ã¦ã„ã¾ã™ã­</strong>
                        <p style="margin-top: 8px; color: #666; font-size: 0.9rem;">
                            å‘¼å¸ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚ºã‚’è©¦ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ
                        </p>
                        <button class="action-btn" onclick="showTab('breathing'); document.querySelector('.tab-btn').click();">
                            ğŸŒ¬ï¸ å‘¼å¸ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚ºã¸
                        </button>
                    </div>`;
                }

                // é‹å‹•ãƒ»å¤–å‡ºã—ã¦ã„ãªã„å ´åˆã®ææ¡ˆ
                if (!factors.includes('exercise') && !factors.includes('outdoor')) {
                    html += `<div class="action-suggestion">
                        <strong>ğŸš¶ å°‘ã—ä½“ã‚’å‹•ã‹ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ</strong>
                        <p style="margin-top: 8px; color: #666; font-size: 0.9rem;">
                            5åˆ†ã®æ•£æ­©ã§ã‚‚æ°—åˆ†ãŒå¤‰ã‚ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ç„¡ç†ã®ãªã„ç¯„å›²ã§è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
                        </p>
                    </div>`;
                }

                // èª°ã¨ã‚‚ä¼šã£ã¦ã„ãªã„å ´åˆ
                if (!factors.includes('social')) {
                    html += `<div class="action-suggestion">
                        <strong>ğŸ‘‹ èª°ã‹ã¨è©±ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ</strong>
                        <p style="margin-top: 8px; color: #666; font-size: 0.9rem;">
                            å®¶æ—ã€å‹äººã€ã¾ãŸã¯ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã§ã®çŸ­ã„ä¼šè©±ã§ã‚‚å¿ƒãŒè»½ããªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
                        </p>
                    </div>`;
                }

                // æ·±åˆ»ãªå ´åˆã®æ³¨æ„å–šèµ·
                if (mood <= 1) {
                    html += `<div class="action-suggestion warning" style="margin-top: 20px;">
                        <strong>ğŸ†˜ è¾›ã„æ™‚ã¯åŠ©ã‘ã‚’æ±‚ã‚ã¦OKã§ã™</strong>
                        <p style="margin-top: 8px; color: #666; font-size: 0.9rem;">
                            ã“ã®çŠ¶æ…‹ãŒç¶šãå ´åˆã¯ã€å°‚é–€å®¶ã«ç›¸è«‡ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚
                            ã€Œæƒ…å ±ã€ã‚¿ãƒ–ã«ç›¸è«‡å…ˆãŒã‚ã‚Šã¾ã™ã€‚
                        </p>
                    </div>`;
                }
            }

            feedbackArea.innerHTML = html;
            feedbackArea.classList.add('show');
        }

        function getFactorLabels(factors) {
            const labels = {
                'sleep_good': 'è‰¯ã„ç¡çœ ',
                'exercise': 'é‹å‹•',
                'outdoor': 'å¤–å‡º',
                'social': 'äººã¨ã®äº¤æµ',
                'progress': 'ä»•äº‹ã®é€²æ—',
                'relax': 'ä¼‘æ¯',
                'sleep_bad': 'ç¡çœ ä¸è¶³',
                'stress': 'ã‚¹ãƒˆãƒ¬ã‚¹'
            };
            return factors.map(f => labels[f] || f);
        }

        function analyzePatterns() {
            const section = document.getElementById('pattern-section');
            const results = document.getElementById('pattern-results');

            if (moodHistory.length < 5) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';

            // è¦å› ã”ã¨ã®æ°—åˆ†å¹³å‡ã‚’è¨ˆç®—
            const factorStats = {};
            const factorCounts = {};

            moodHistory.forEach(entry => {
                if (entry.factors && entry.factors.length > 0) {
                    entry.factors.forEach(factor => {
                        if (!factorStats[factor]) {
                            factorStats[factor] = 0;
                            factorCounts[factor] = 0;
                        }
                        factorStats[factor] += entry.mood;
                        factorCounts[factor]++;
                    });
                }
            });

            // å¹³å‡ã‚’è¨ˆç®—
            const factorAverages = {};
            for (const factor in factorStats) {
                if (factorCounts[factor] >= 2) {
                    factorAverages[factor] = factorStats[factor] / factorCounts[factor];
                }
            }

            // ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç”Ÿæˆ
            const patterns = [];
            const overallAvg = moodHistory.reduce((sum, e) => sum + e.mood, 0) / moodHistory.length;

            for (const factor in factorAverages) {
                const avg = factorAverages[factor];
                const diff = avg - overallAvg;
                const count = factorCounts[factor];

                if (Math.abs(diff) >= 0.5 && count >= 2) {
                    patterns.push({
                        factor: factor,
                        avg: avg,
                        diff: diff,
                        count: count,
                        positive: diff > 0
                    });
                }
            }

            // å·®ãŒå¤§ãã„é †ã«ã‚½ãƒ¼ãƒˆ
            patterns.sort((a, b) => Math.abs(b.diff) - Math.abs(a.diff));

            if (patterns.length === 0) {
                results.innerHTML = `
                    <div class="pattern-item">
                        <span class="icon">ğŸ“Š</span>
                        <span class="text">ã‚‚ã†å°‘ã—ãƒ‡ãƒ¼ã‚¿ãŒé›†ã¾ã‚‹ã¨ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒè¦‹ãˆã¦ãã¾ã™</span>
                    </div>
                `;
                return;
            }

            let html = '';
            patterns.slice(0, 5).forEach(p => {
                const label = getFactorLabels([p.factor])[0];
                const icon = p.positive ? 'ğŸ“ˆ' : 'ğŸ“‰';
                const message = p.positive
                    ? `ã€Œ${label}ã€ãŒã‚ã‚‹æ—¥ã¯æ°—åˆ†ãŒè‰¯ã„å‚¾å‘`
                    : `ã€Œ${label}ã€ãŒã‚ã‚‹æ—¥ã¯æ°—åˆ†ãŒä¸‹ãŒã‚‹å‚¾å‘`;
                const badge = p.positive ? 'åŠ¹æœã‚ã‚Š' : 'è¦æ³¨æ„';
                const badgeClass = p.positive ? '' : 'negative';

                html += `
                    <div class="pattern-item">
                        <span class="icon">${icon}</span>
                        <span class="text">${message}</span>
                        <span class="badge ${badgeClass}">${badge}</span>
                    </div>
                `;
            });

            // æ„Ÿè¬è¨˜éŒ²ã®åŠ¹æœ
            const withGratitude = moodHistory.filter(e => e.gratitude && e.gratitude.length > 0);
            if (withGratitude.length >= 3) {
                const gratitudeAvg = withGratitude.reduce((sum, e) => sum + e.mood, 0) / withGratitude.length;
                if (gratitudeAvg > overallAvg + 0.3) {
                    html += `
                        <div class="pattern-item">
                            <span class="icon">âœ¨</span>
                            <span class="text">æ„Ÿè¬ã‚’è¨˜éŒ²ã—ãŸæ—¥ã¯æ°—åˆ†ãŒè‰¯ã„å‚¾å‘</span>
                            <span class="badge">åŠ¹æœã‚ã‚Š</span>
                        </div>
                    `;
                }
            }

            results.innerHTML = html;
        }

        function displayMoodChart() {
            const container = document.getElementById('mood-chart-container');
            if (moodHistory.length < 2) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';

            // ç›´è¿‘7æ—¥åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const last7 = moodHistory.slice(0, 7).reverse();
            const labels = last7.map(m => m.date.replace(/^\d+\//, ''));
            const data = last7.map(m => m.mood);

            if (moodChart) {
                moodChart.destroy();
            }

            const ctx = document.getElementById('mood-chart').getContext('2d');
            moodChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'æ°—åˆ†',
                        data: data,
                        borderColor: '#4ECDC4',
                        backgroundColor: 'rgba(78, 205, 196, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#4ECDC4',
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            min: 0,
                            max: 5,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    const emojis = ['ğŸ˜¤', 'ğŸ˜¢', 'ğŸ˜°', 'ğŸ˜', 'ğŸ™‚', 'ğŸ˜„'];
                                    return emojis[value] || '';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // ==================== æ€è€ƒè»¢æ› ====================
        const cognitiveDistortions = [
            {
                name: "å…¨ã‹ç„¡ã‹æ€è€ƒ",
                pattern: /å¤±æ•—|ã†ã¾ãã„ã‹ãªã„|ãƒ€ãƒ¡|ã§ããªã„|ç„¡ç†/,
                description: "ç‰©äº‹ã‚’ç™½ã‹é»’ã‹ã§åˆ¤æ–­ã™ã‚‹è€ƒãˆæ–¹",
                reframe: "å®Œç’§ã§ãªãã¦ã‚‚ã€Œ80ç‚¹ã€ã§ååˆ†ã€‚å°ã•ãªæˆåŠŸã‚‚èªã‚ã¾ã—ã‚‡ã†ã€‚"
            },
            {
                name: "éåº¦ã®ä¸€èˆ¬åŒ–",
                pattern: /ã„ã¤ã‚‚|çµ¶å¯¾|ã¿ã‚“ãª|èª°ã‚‚|å…¨éƒ¨/,
                description: "ä¸€åº¦ã®å‡ºæ¥äº‹ã‹ã‚‰ã€Œã„ã¤ã‚‚ãã†ã ã€ã¨æ±ºã‚ã¤ã‘ã‚‹",
                reframe: "ã€Œä»Šå›ã¯ã€ã€Œã“ã®å ´é¢ã§ã¯ã€ã¨é™å®šã—ã¦è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚"
            },
            {
                name: "èª­å¿ƒè¡“",
                pattern: /æ€ã‚ã‚Œ|è¦‹ã‚‰ã‚Œ|ãã£ã¨.+ã ã‚ã†|ãŸã¶ã‚“.+ã¯ãš/,
                description: "ç›¸æ‰‹ã®è€ƒãˆã‚’å‹æ‰‹ã«æ¨æ¸¬ã—ã¦æ±ºã‚ã¤ã‘ã‚‹",
                reframe: "æœ¬å½“ã«ãã†æ€ã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã—ãŸã‹ï¼Ÿæ¡ˆå¤–é•ã†ã‹ã‚‚ã€‚"
            },
            {
                name: "ç ´å±€çš„æ€è€ƒ",
                pattern: /æœ€æ‚ª|çµ‚ã‚ã‚Š|å–ã‚Šè¿”ã—|ã‚‚ã†ãƒ€ãƒ¡/,
                description: "æœ€æ‚ªã®çµæœã°ã‹ã‚Šã‚’æƒ³åƒã™ã‚‹",
                reframe: "æœ€æ‚ªã®å ´åˆã§ã‚‚ã€æœ¬å½“ã«å–ã‚Šè¿”ã—ãŒã¤ã‹ãªã„ã§ã™ã‹ï¼Ÿ"
            },
            {
                name: "ã¹ãæ€è€ƒ",
                pattern: /ã¹ã|ã—ãªãã‚ƒ|ã—ãªã„ã¨|ã­ã°/,
                description: "ã€Œã€œã™ã¹ãã€ã¨è‡ªåˆ†ã‚’è¿½ã„è©°ã‚ã‚‹",
                reframe: "ã€Œã€œã—ãŸã„ã€ã€Œã€œã§ããŸã‚‰ã„ã„ãªã€ã«è¨€ã„æ›ãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚"
            }
        ];

        function fillWorry(text) {
            document.getElementById('worry-input').value = text;
        }

        function analyzeWorry() {
            const worry = document.getElementById('worry-input').value.trim();
            if (!worry) {
                alert('ä¸å®‰ã‚„æ‚©ã¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const found = cognitiveDistortions.filter(d => d.pattern.test(worry));
            const responseArea = document.getElementById('worry-response');

            let html = `<h3>ğŸ” åˆ†æçµæœ</h3><p>ã¾ãšæ›¸ãå‡ºã›ãŸã“ã¨ãŒç´ æ™´ã‚‰ã—ã„ç¬¬ä¸€æ­©ã§ã™ã€‚</p>`;

            if (found.length > 0) {
                html += `<h4 style="color: #FF6B6B; margin: 20px 0 15px;">âš ï¸ è¦‹ã¤ã‹ã£ãŸæ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³</h4>`;
                found.forEach(d => {
                    html += `
                        <div class="distortion-box">
                            <h4>ã€Œ${d.name}ã€ã®å‚¾å‘</h4>
                            <p style="color: #666; font-size: 0.9rem;">${d.description}</p>
                        </div>
                        <div class="reframe-box" style="cursor: default;">
                            <h4>ğŸ’š åˆ¥ã®è¦–ç‚¹</h4>
                            <p style="color: #666; font-size: 0.9rem;">${d.reframe}</p>
                        </div>
                    `;
                });
            } else {
                html += `
                    <div class="reframe-box" style="cursor: default;">
                        <h4>ğŸ’š æŒ¯ã‚Šè¿”ã‚Šãƒã‚¤ãƒ³ãƒˆ</h4>
                        <ul style="margin-top: 10px; padding-left: 20px; color: #666;">
                            <li>ã“ã®ä¸å®‰ã¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§ãã‚‹ã“ã¨ï¼Ÿ</li>
                            <li>æœ€æ‚ªã®å ´åˆã€å®Ÿéš›ã©ã†ãªã‚‹ï¼Ÿ</li>
                            <li>1å¹´å¾Œã€ã“ã®ä¸å®‰ã‚’è¦šãˆã¦ã‚‹ï¼Ÿ</li>
                        </ul>
                    </div>
                `;
            }

            responseArea.innerHTML = html;
            responseArea.classList.add('show');
        }

        // ==================== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ====================
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function loadAllData() {
            // Quick Winèª­ã¿è¾¼ã¿
            const savedWins = localStorage.getItem('mentalcare_wins');
            if (savedWins) {
                winHistory = JSON.parse(savedWins);
                displayWins();
                updateStreak();
            }

            // æ°—åˆ†å±¥æ­´èª­ã¿è¾¼ã¿
            const savedMood = localStorage.getItem('mentalcare_mood');
            if (savedMood) {
                moodHistory = JSON.parse(savedMood);
                displayMoodChart();
                analyzePatterns();
            }
        }
    </script>
</body>
</html>
